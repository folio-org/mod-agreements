name: Integration test module

on:
  push:

jobs:
  work-source-identifier-tirs-tests:
    uses: ./.github/workflows/run-int-tests.yml@github_actions_parallel
    with:
      testPath: org.olf.TIRS.WorkSourceIdentifier.*
      outputDirectory: WorkSourceIdentifierTests
  id-first-tirs-tests:
    uses: ./.github/workflows/run-int-tests.yml@github_actions_parallel
    with:
      testPath: org.olf.TIRS.IdFirstTIRS.*
      outputDirectory: IdFirstTests
      tirsEnvVar: IdFirst
  agreement-tests:
    uses: ./.github/workflows/run-int-tests.yml@github_actions_parallel
    with:
      testPath: org.olf.AgreementTests.*
      outputDirectory: AgreementTests
  string-template-tests:
    uses: ./.github/workflows/run-int-tests.yml@github_actions_parallel
    with:
      testPath: org.olf.StringTemplateTests.*
      outputDirectory: StringTemplateTests
  general-tests:
    uses: ./.github/workflows/run-int-tests.yml@github_actions_parallel
    with:
      testPath: org.olf.GeneralTests.*
      outputDirectory: GeneralTests
  publish-test-results:
    needs: [work-source-identifier-tests, id-first-tirs-tests, agreement-tests, string-template-tests, general-tests]
    runs-on: ubuntu-latest
    steps:
      - name: 'setup directories to accept test results'
        run: |
          mkdir -p testLogs/WorkSourceIdentifierTests
          mkdir -p testLogs/IdFirstTests
          mkdir -p testLogs/AgreementTests
          mkdir -p testLogs/StringTemplateTests
          mkdir -p testLogs/GeneralTests
      - name: 'download WorkSourceIdentifier test results'
        uses: actions/download-artifact@v4
        with:
          name: WorkSourceIdentifierTests
          path: testLogs/WorkSourceIdentifierTests
      - name: 'download IdFirst test results'
        uses: actions/download-artifact@v4
        with:
          name: IdFirstTests
          path: testLogs/IdFirstTests
      - name: 'download AgreementTests test results'
        uses: actions/download-artifact@v4
        with:
          name: AgreementTests
          path: testLogs/AgreementTests
      - name: 'download StringTemplateTests test results'
        uses: actions/download-artifact@v4
        with:
          name: StringTemplateTests
          path: testLogs/StringTemplateTests
      - name: 'download GeneralTests test results'
        uses: actions/download-artifact@v4
        with:
          name: GeneralTests
          path: testLogs/GeneralTests
      - name: Display structure of downloaded files
        run: ls -R
      - name: Publish Test Results
        uses: EnricoMi/publish-unit-test-result-action@v2
        with:
          files: "testLogs/**/*.xml"
